{% extends "base.html" %} {% block title %} Register User | Sparrow App{%
endblock %} {% block content %}
<div
  x-data="{  message: '', showError: false }"
  class="bg-gray-100 dark:bg-gray-900 flex justify-center items-center h-screen my-auto"
>
  <div class="bg-indigo-100 shadow-lg rounded-lg p-8">
    <!-- <form @submit.prevent="setCookie" action="/login" method="post" class="login-form" id="login-form"></form> -->
    <form class="max-w-md mx-auto">
      <h1
        class="text-2xl font-bold mb-4 text-center"
        style="min-width: 300px; color: #1a56db"
      >
        Register User
      </h1>
      <img
        id="login-logo"
        src="/static/img/logo/undraw_register.png"
        alt="Login Logo"
        class="max-w-xs rounded-full opacity-50 shadow-md mb-4 mx-auto"
      />
      <div class="mb-4">
        <label
          for="email"
          class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
          >Email address</label
        >
        <input
          type="email"
          id="email"
          name="username"
          _="on change if my.value is '' 
                add @disabled to #password and #repeat-password
                remove .hidden from #username-error
            else
                js return /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/ end
                set pattern to it
                if (pattern.test(my value)) == false
                remove .hidden from #username-error
            else
                add .hidden to #username-error 
                remove .hidden from #password
                remove .hidden from #repeat-password
                remove .hidden from #password-label
                remove .hidden from #repeat-password-label
                remove .hidden from #password-message"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
          placeholder="john.doe@company.com"
          autocomplete="off"
          required
        />
        <p
          id="username-error"
          class="hidden mb-2 text-red-600 dark:text-red-500"
        >
          <span class="font-medium">Please enter a valid email address</span>
        </p>
      </div>
      <div class="mb-2">
        <label
          for="password"
          id="password-label"
          class="hidden block mb-2 text-sm font-medium text-gray-900 dark:text-white"
          >Password</label
        >
        <input
          type="password"
          id="password"
          name="password"
          class="hidden bg-gray-50 mb-4 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
          autocomplete="new-password"
          placeholder="•••••••••"
          required
        />
        <div class="mb-2">
          <label
            for="repeat-password"
            id="repeat-password-label"
            class="hidden block mb-2 text-sm font-medium text-gray-900 dark:text-white"
            >Repeat password</label
          >
          <input
            type="password"
            id="repeat-password"
            class="hidden shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 dark:shadow-sm-light"
            placeholder="•••••••••"
            required
          />
        </div>

        <div
          id="password-message"
          class="mt-1 text-sm text-gray-500 dark:text-gray-300"
        >
          Your password should be at least 8 characters long and include at
          least one numerical digit, one character, and one capital letter.
        </div>
      </div>
      <p
        x-text="message"
        x-show="showError"
        class="mb-2 text-red-600 dark:text-red-500"
      >
        <span class="font-medium"></span>
      </p>
      <div class="mt-4"></div>
    </form>
    <!-- </form> -->
    <button
      type="submit"
      id="register-button"
      _='on click 
              js 
                const formData = new URLSearchParams();
                formData.append("username", "username");
                formData.append("password", "password");
                fetch("/auth/jwt/login", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                  },
                  body: formData,
                }).then((response) => {
                  if (response.status === 204) {
                    // Successful login, navigate to /dashboard
                    window.location.href = "/dashboard";
                  } else if (response.status === 400) {
                    // Incorrect username or password
                    this.message = "Incorrect username or password";
                    this.showError = true;
                  }
                });
              end 
      class="text-white bg-blue-700 hover-bg-blue-800 focus-ring-4 focus-outline-none focus-ring-blue-300 font-medium rounded-lg text-sm w-full sm-w-auto px-5 py-2.5 text-center dark-bg-blue-600 dark-hover-bg-blue-700 dark-focus-ring-blue-800"
    >
      Register new account
    </button>
    <output></output>
  </div>
</div>

<script>
  function makeFormData() {
    return new URLSearchParams();
  }
  // function setCookie() {
  //   // Get the username and password from the form
  //   const username = document.getElementById("email").value;
  //   const password = document.getElementById("password").value;

  //   const formData = new URLSearchParams();
  //   formData.append("grant_type", "");
  //   formData.append("username", username);
  //   formData.append("password", password);
  //   formData.append("scope", "");
  //   formData.append("client_id", "");
  //   formData.append("client_secret", "");

  //   fetch("/auth/jwt/login", {
  //     method: "POST",
  //     headers: {
  //       "Content-Type": "application/x-www-form-urlencoded",
  //     },
  //     body: formData,
  //   })
  //     .then((response) => {
  //       if (response.status === 204) {
  //         // Successful login, navigate to /dashboard
  //         window.location.href = "/dashboard";
  //       } else if (response.status === 400) {
  //         // Incorrect username or password
  //         this.message = "Incorrect username or password";
  //         this.showError = true;
  //       }
  //     })
  //     .then((errorMessage) => {
  //       if (errorMessage) {
  //         Alpine.store("message", "Error: Incorrect username or password");
  //         console.log(errorMessage);
  //       }
  //     });

  //   Alpine.data("login", () => ({
  //     setCookie,
  //   }));
  // }
</script>
{% endblock %}
